<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Ruby in Atomo</title>
    <link rel="stylesheet" type="text/css" href="anatomy.css" />
    <link rel="stylesheet" type="text/css" href="highlight.css" />
  </head>
  <body class="with-sidebar annotated">
    <div id="sidebar">
       <h4>On this page:</h4>
<ol class="toc"><li><a href="ruby.html">Ruby in Atomo</a></li></ol>
<h4>Up one level:</h4><ol class="toc"><li><a href=".Tutorials.html">Tutorials</a><ol><li><a href="ruby.html">Ruby in Atomo</a></li></ol></li></ol>
    </div>

    <div id="content">
<table class="annotated-source"><thead><tr><th class="prose"><h1>Ruby in Atomo</h1></th><th class="code"></th></tr></thead>

<tr><td class="prose"><p>Ruby provides three powerful mechanisms for modular code and simple definition of class structures: modules, classes, and mixins. Atomo doesn't have these built into the language at the design level, but all three are rather easily implemented using Atomo itself, building upon its simple object system.</p><p>This document will guide you through its implementation, which is entirely composed of macros; it should serve as a great introduction to metaprogramming in Atomo with macros.</p></td><td class="code"></td></tr>

<tr><td class="prose"><p>Modules will be stored here, as <code><span class="n"><a href="association.html#definition_Association">Association</a></span></code>s from the module's name, a string, to its contents, a list of expressions.</p><p>Here we use <code><span class="kr">for-macro</span></code>, a reserved word that tells the parser to evaluate this expression before the macroexpansion phase. We'll also use it later to define helper methods for our macros to use.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="n">*modules*</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="p">[</span><span class="p">]</span></pre></div></td></tr>

<tr><td class="prose"><p>Next, we'll need a nice syntax for defining modules. We can use a neat trick with Atomo's parser here - <code><span class="nf">a:</span><span class="t"> </span><span class="nf">b:</span><span class="t"> </span><span class="n">c</span></code> is parsed as <code><span class="nf">a:</span><span class="t"> </span><span class="p">(</span><span class="nf">b:</span><span class="t"> </span><span class="n">c</span><span class="p">)</span></code> - that is, one keyword dispatch <code><span class="nf">a:</span></code> with another, <code><span class="nf">b:</span><span class="t"> </span><span class="n">c</span></code>, as its second target (the first being the implicit toplevel object).</p><p>We'll use <code><span class="n">module</span></code> as the first keyword, and the keyword in the nested dispatch will be the name of the module. The second target in the nested dispatch will be the module's body, a block. Taking advantage of this, we get very simple module definition syntax, and also guarantee that a module can't be given some funky name.</p><p>Here's what it'll look like:

</p><div class="highlight"><pre><span class="nf">module:</span><span class="t"> </span><span class="nf">Foo:</span><span class="t"> </span><span class="p">{</span><span class="t">
  </span><span class="c1">-- body goes here</span><span class="t">
</span><span class="p">}</span></pre></div></td><td class="code"></td></tr>

<tr><td class="prose"><p>Registers the module, and just expands to the body block (though what it expands to isn't very important).</p></td><td class="code"><div class="highlight"><pre><span class="kr">macro</span><span class="t"> </span><span class="p">(</span><span class="nf"><a href="class-objects.html#definition_module:">module:</a></span><span class="t"> </span><span class="p">(</span><span class="nf">def:</span><span class="t"> </span><span class="n">Dispatch</span><span class="p">)</span><span class="p">)</span><span class="t">
  </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">def</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_names">names</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t">
    </span><span class="n">body</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">def</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_targets">targets</a></span><span class="t"> </span><span class="nf"><a href="lists.html#definition_at:">at:</a></span><span class="t"> </span><span class="mi">1</span><span class="t">
    </span><span class="nf">add-module:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="nf">as:</span><span class="t"> </span><span class="n">body</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_contents">contents</a></span><span class="t">
    </span><span class="n">body</span><span class="t">
  </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_call">call</a></span></pre></div></td></tr>

<tr><td class="prose"><p><code><span class="nf">add-module:</span><span class="nf">as:</span></code> is a small helper method for registering a module. We're using <code><span class="n"><a href="core.html#definition_super">super</a></span></code> here to specifically redefine the <code><span class="n">*modules*</span></code> we created earlier.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">add-module:</span><span class="t"> </span><span class="p">(</span><span class="nf">name:</span><span class="t"> </span><span class="n">String</span><span class="p">)</span><span class="t"> </span><span class="nf"><a href="ecosystem.html#definition_as:">as:</a></span><span class="t"> </span><span class="p">(</span><span class="nf">body:</span><span class="t"> </span><span class="n"><a href="lists.html#definition_List">List</a></span><span class="p">)</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="n"><a href="core.html#definition_super">super</a></span><span class="t"> </span><span class="n">*modules*</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">*modules*</span><span class="t"> </span><span class="nf"><a href="association.html#definition_set:to:">set:</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="nf"><a href="association.html#definition_set:to:">to:</a></span><span class="t"> </span><span class="n">body</span></pre></div></td></tr>

<tr><td class="prose"><p>Now when we say <code><span class="nf">module:</span><span class="t"> </span><span class="nf">A:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">b</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="mi">2</span><span class="t"> </span><span class="p">}</span></code>, a module <code><span class="n">A</span></code> will be inserted into <code><span class="n">*modules*</span></code>, associated with <code><span class="p">[</span><span class="ss">'</span><span class="p">(</span><span class="n">b</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="mi">2</span><span class="p">)</span><span class="p">]</span></code> - a list of its contents.</p><p>Nothing too useful yet - the fun begins when we <code><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span></code> it! So let's work on that.</p></td><td class="code"></td></tr>

<tr><td class="prose"><p>Slurps a module, found via a given <code><span class="n"><a href="patterns.html#definition_name">name</a></span></code>, into its target, often the implicit toplevel object.</p></td><td class="code"><div class="highlight"><pre><span class="kr">macro</span><span class="t"> </span><span class="p">(</span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="p">(</span><span class="nf"><a href="ecosystem.html#definition_name:">name:</a></span><span class="t"> </span><span class="n">Dispatch</span><span class="p">)</span><span class="p">)</span><span class="t">
  </span><span class="nf">include:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span></pre></div></td></tr>

<tr><td class="prose"><p>Search for a module by name, panicking if it isn't registered. Returns an expression for defining the module's body onto the target.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">include:</span><span class="t"> </span><span class="p">(</span><span class="nf">name:</span><span class="t"> </span><span class="n">String</span><span class="p">)</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="n">*modules*</span><span class="t"> </span><span class="p">(</span><span class="nf"><a href="association.html#definition_lookup:">lookup:</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="p">)</span><span class="t"> </span><span class="nf"><a href="patterns.html#definition_match:">match:</a></span><span class="t"> </span><span class="p">{</span><span class="t">
    </span><span class="nd">@none</span><span class="t"> </span><span class="o"><a href="association.html#definition_-&gt;:">-&gt;</a></span><span class="t"> </span><span class="nf">error:</span><span class="t"> </span><span class="nd">@</span><span class="p">(</span><span class="nf">unknown-module:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="p">)</span><span class="t">

    </span><span class="nd">@</span><span class="p">(</span><span class="nf">ok:</span><span class="t"> </span><span class="n">mod</span><span class="p">)</span><span class="t"> </span><span class="o"><a href="association.html#definition_-&gt;:">-&gt;</a></span><span class="t">
      </span><span class="p">{</span><span class="t"> </span><span class="n">block</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t">
          </span><span class="ss">`Block</span><span class="t"> </span><span class="nf">new:</span><span class="t"> </span><span class="p">(</span><span class="nf">expand-body:</span><span class="t"> </span><span class="n">mod</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="ss">`!top</span><span class="p">)</span><span class="t">
            </span><span class="nf">arguments:</span><span class="t"> </span><span class="p">[</span><span class="ss">`!top</span><span class="p">]</span><span class="t">

        </span><span class="ss">`</span><span class="p">(</span><span class="si">~target</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:with:">join:</a></span><span class="t"> </span><span class="si">~block</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:with:">with:</a></span><span class="t"> </span><span class="si">~target</span><span class="p">)</span><span class="t">
      </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_call">call</a></span><span class="t">
  </span><span class="p">}</span></pre></div></td></tr>

<tr><td class="prose"><p>It's important to note that we're using special names here, notably <code><span class="n">!top</span></code>, to avoid name collision. These names are guaranteed to be safe; each time the macro expands, identifiers in a quasiquote beginning with an exclamation mark are decorated with a clock value, so there's no way for it to be confused with some other name from outside the expansion.</p></td><td class="code"></td></tr>

<tr><td class="prose"><p>Maps over a given list of expressions, expanding its contents into their module or class forms.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">expand-body:</span><span class="t"> </span><span class="p">(</span><span class="nf">exprs:</span><span class="t"> </span><span class="n"><a href="lists.html#definition_List">List</a></span><span class="p">)</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="n">exprs</span><span class="t"> </span><span class="nf"><a href="lists.html#definition_map:">map:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">e</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="nf">expand-expr:</span><span class="t"> </span><span class="n">e</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="p">}</span></pre></div></td></tr>

<tr><td class="prose"><p>Come up with a method definition expression that has a the current instance as the method body's context. Ruby and Java use <code>self</code> or <code>this</code> for explicitly referring to this value, but both of these names are taken in Atomo, so we'll go with <code><span class="n"><a href="class-objects.html#definition_me">me</a></span></code>.</p><p>To be clear, here are the transformations it makes:

</p><dl><dt><code><span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n">y</span></code></dt><dd><div class="highlight"><pre><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="p">}</span><span class="t"> </span></pre></div></dd>

<dt><code><span class="nf">x:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="numbers.html#definition_+:">+</a></span><span class="t"> </span><span class="mi">1</span></code></dt><dd><div class="highlight"><pre><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="nf">x:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf">join:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="numbers.html#definition_+:">+</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span><span class="t"> </span></pre></div></dd>

<dt><code><span class="n"><a href="core.html#definition_new">new</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span></code></dt><dd><div class="highlight"><pre><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n"><a href="core.html#definition_new">new</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_do:">do:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span><span class="t"> </span></pre></div></dd>

<dt><code><span class="nf"><a href="core.html#definition_new:">new:</a></span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="p">}</span></code></dt><dd><div class="highlight"><pre><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="nf">new:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="t"> </span><span class="nf">do:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="p">}</span><span class="t"> </span></pre></div></dd>

<dt><code><span class="nf">new.foo:</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="nf">bar:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">x</span><span class="p">;</span><span class="t"> </span><span class="n">b</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="p">}</span></code></dt><dd><div class="highlight"><pre><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="nf">new.foo:</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="nf">bar:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_do:">do:</a></span><span class="t"> </span><span class="p">{</span><span class="t">
    </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">x</span><span class="t">
    </span><span class="n">b</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">y</span><span class="t">
  </span><span class="p">}</span></pre></div></dd></dl></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">expand-expr:</span><span class="t"> </span><span class="ss">`</span><span class="p">(</span><span class="si">~name</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="si">~body</span><span class="p">)</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="p">{</span><span class="t"> </span><span class="n">with-me</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t">
      </span><span class="ss">`Dispatch</span><span class="t"> </span><span class="nf">new:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n">particle</span><span class="t">
        </span><span class="nf">to:</span><span class="t"> </span><span class="p">(</span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_targets">targets</a></span><span class="t"> </span><span class="nf">at:</span><span class="t"> </span><span class="mi">0</span><span class="t"> </span><span class="nf">put:</span><span class="t"> </span><span class="ss">`</span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="si">~target</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="p">)</span><span class="t">
        </span><span class="nf">&amp;optionals:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n">optionals</span><span class="t">

    </span><span class="nf">if:</span><span class="t"> </span><span class="p">(</span><span class="nf">initializer?:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n">particle</span><span class="p">)</span><span class="t">
      </span><span class="nf">then:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="ss">`</span><span class="p">(</span><span class="si">~with-me</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="si">~target</span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_do:">do:</a></span><span class="t"> </span><span class="si">~body</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t">
      </span><span class="nf">else:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="ss">`</span><span class="p">(</span><span class="si">~with-me</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="si">~body</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t">
  </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_call">call</a></span></pre></div></td></tr>

<tr><td class="prose"><p>Expands an <code><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span></code> expression into the module's body, executed onto the given target (the class object or another module).</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">expand-expr:</span><span class="t"> </span><span class="ss">`</span><span class="p">(</span><span class="nf">include:</span><span class="t"> </span><span class="si">~</span><span class="p">(</span><span class="nf">y:</span><span class="t"> </span><span class="n">Dispatch</span><span class="p">)</span><span class="p">)</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="nf">include:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_target">target</a></span></pre></div></td></tr>

<tr><td class="prose"><p>Leave everything else alone.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">expand-expr:</span><span class="t"> </span><span class="n">e</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="n">_</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n">e</span></pre></div></td></tr>

<tr><td class="prose"><p>Determine if a given method name looks like an initializer. True if the name is <code>new</code>, or if the first keyword is <code>new</code> or starts with <code>new.</code>.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">initializer?:</span><span class="t"> </span><span class="p">(</span><span class="nf"><a href="ecosystem.html#definition_name:">name:</a></span><span class="t"> </span><span class="n"><a href="particles.html#definition_Particle">Particle</a></span><span class="p">)</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n"><a href="particles.html#definition_type">type</a></span><span class="t"> </span><span class="nf"><a href="patterns.html#definition_match:">match:</a></span><span class="t"> </span><span class="p">{</span><span class="t">
    </span><span class="nd">@single</span><span class="t"> </span><span class="o"><a href="association.html#definition_-&gt;:">-&gt;</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="o"><a href="comparable.html#definition_==:">==</a></span><span class="t"> </span><span class="nd">@new</span><span class="t">

    </span><span class="nd">@keyword</span><span class="t"> </span><span class="o"><a href="association.html#definition_-&gt;:">-&gt;</a></span><span class="t">
      </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_names">names</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t"> </span><span class="o"><a href="comparable.html#definition_==:">==</a></span><span class="t"> </span><span class="s">&quot;</span><span class="s">new</span><span class="s">&quot;</span><span class="t"> </span><span class="o"><a href="boolean.html#definition_||:">||</a></span><span class="t">
        </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="n"><a href="patterns.html#definition_names">names</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t"> </span><span class="nf">starts-with?:</span><span class="t"> </span><span class="s">&quot;</span><span class="s">new.</span><span class="s">&quot;</span><span class="t">
  </span><span class="p">}</span></pre></div></td></tr>



<tr><td class="prose"><p>We already have a pretty useful module system, so let's give it a whirl!

</p><div class="highlight"><pre><span class="nf">module:</span><span class="t"> </span><span class="nf">Math:</span><span class="t"> </span><span class="p">{</span><span class="t">
  </span><span class="c1">-- an unexposed value</span><span class="t">
  </span><span class="n">some-helper</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">10</span><span class="t">

  </span><span class="c1">-- exposed methods</span><span class="t">
  </span><span class="n">pi</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="mf">3.14</span><span class="t">
  </span><span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n">some-helper</span><span class="t">
</span><span class="p">}</span></pre></div>

<pre class="interaction"><span class="caret">&gt;</span> <span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">Math</span>
<span class="nd">@ok</span>
<span class="caret">&gt;</span> <span class="n">pi</span>
<span class="mf">3.14</span>
<span class="caret">&gt;</span> <span class="n">x</span>
<span class="mi">10</span>
</pre><p>Ok, that seems to work. But that's very basic. Let's try including one module into another.

</p><div class="highlight"><pre><span class="nf">module:</span><span class="t"> </span><span class="nf">MoreMath:</span><span class="t"> </span><span class="p">{</span><span class="t">
  </span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">Math</span><span class="t">

  </span><span class="n">another-helper</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">pi</span><span class="t">

  </span><span class="n">pi*2</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n">another-helper</span><span class="t"> </span><span class="o"><a href="numbers.html#definition_*:">*</a></span><span class="t"> </span><span class="mi">2</span><span class="t">
</span><span class="p">}</span></pre></div>

<pre class="interaction"><span class="caret">&gt;</span> <span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">MoreMath</span>
<span class="nd">@ok</span>
<span class="caret">&gt;</span> <span class="n">pi</span>
<span class="mf">3.14</span>
<span class="caret">&gt;</span> <span class="n">x</span>
<span class="mi">10</span>
<span class="caret">&gt;</span> <span class="n">pi*2</span>
<span class="mf">6.28</span>
</pre><p>And what happens when we include some unknown module?

</p><pre class="interaction"><span class="caret">&gt;</span> <span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">FooBar</span>
<span class="gr">ERROR: <span class="go">&lt;e</span><span class="go">rror @(unknown-module: &quot;FooBar&quot;)</span><span class="go">&gt;</span></span>
</pre><p>Hooray! Delicious failure. Seems to all be in working order. So let's move on to classes.</p></td><td class="code"></td></tr>

<tr><td class="prose"><p>Creates an anonymous class object, extending a given parent object, defaulting to <code><span class="n"><a href="core.html#definition_Object">Object</a></span></code>.</p></td><td class="code"><div class="highlight"><pre><span class="kr">macro</span><span class="t"> </span><span class="p">(</span><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="p">(</span><span class="nf">b:</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_Block">Block</a></span><span class="p">)</span><span class="t"> </span><span class="nf">&amp;extends:</span><span class="t"> </span><span class="n"><a href="core.html#definition_Object">Object</a></span><span class="p">)</span><span class="t">
  </span><span class="ss">`</span><span class="p">(</span><span class="si">~</span><span class="p">(</span><span class="nf">class-create:</span><span class="t"> </span><span class="n">b</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_contents">contents</a></span><span class="p">)</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="si">~extends</span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="p">)</span></pre></div></td></tr>

<tr><td class="prose"><p>Create a block for creating a class, given the class body (a list of expressions). This block takes a single argument: the target of the definitions, which is normally a clone of the parent object.</p><p>The block also defines <code><span class="n"><a href="class-objects.html#definition_me">me</a></span></code>, so that a class's body can refer to the class object.</p><p>Again we're using a special name, <code><span class="n">!o</span></code>, to prevent name collision.</p></td><td class="code"><div class="highlight"><pre><span class="kr">for-macro</span><span class="t"> </span><span class="nf">class-create:</span><span class="t"> </span><span class="p">(</span><span class="nf">body:</span><span class="t"> </span><span class="n"><a href="lists.html#definition_List">List</a></span><span class="p">)</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
  </span><span class="ss">`Block</span><span class="t"> </span><span class="nf">new:</span><span class="t"> </span><span class="p">(</span><span class="ss">`</span><span class="p">(</span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">!o</span><span class="p">)</span><span class="t"> </span><span class="o"><a href="ecosystem.html#definition_.:">.</a></span><span class="t"> </span><span class="p">(</span><span class="nf">expand-body:</span><span class="t"> </span><span class="n">body</span><span class="t"> </span><span class="nf">on:</span><span class="t"> </span><span class="ss">`!o</span><span class="p">)</span><span class="t"> </span><span class="o"><a href="lists.html#definition_..:">..</a></span><span class="t"> </span><span class="p">[</span><span class="ss">`!o</span><span class="p">]</span><span class="p">)</span><span class="t">
            </span><span class="nf">arguments:</span><span class="t"> </span><span class="p">[</span><span class="ss">`!o</span><span class="p">]</span></pre></div></td></tr>


<tr><td class="prose"><p>So now we have fully-functional (anonymous) classes with mixins. We can play around with this a bit already:

</p><div class="highlight"><pre><span class="n">Greeter</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t">
  </span><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="p">{</span><span class="t">
    </span><span class="nf"><a href="core.html#definition_new:">new:</a></span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="p">}</span><span class="t">
    </span><span class="n">say-hi</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">(</span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="o"><a href="lists.html#definition_..:">..</a></span><span class="t"> </span><span class="s">&quot;</span><span class="s">: Hi!</span><span class="s">&quot;</span><span class="p">)</span><span class="t"> </span><span class="n"><a href="io.html#definition_print">print</a></span><span class="t">
  </span><span class="p">}</span></pre></div>

<pre class="interaction"><span class="caret">&gt;</span> <span class="n">Greeter</span><span class="t"> </span><span class="p">(</span><span class="nf"><a href="core.html#definition_new:">new:</a></span><span class="t"> </span><span class="s">&quot;</span><span class="s">John Smith</span><span class="s">&quot;</span><span class="p">)</span><span class="t"> </span><span class="n">say-hi</span>
John Smith: Hi!
<span class="s">&quot;</span><span class="s">John Smith: Hi!</span><span class="s">&quot;</span>
</pre></td><td class="code"></td></tr>

<tr><td class="prose"><p>That seems to be working pretty nicely. Now let's dig into class reopening! We'll be adding a second form of <code><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span></code>, this one taking a keyword dispatch very similar to the trick we used for <code><span class="nf"><a href="class-objects.html#definition_module:">module:</a></span></code>. But now we can decide whether to define a new class or &quot;reopen&quot; an existing one.</p></td><td class="code"></td></tr>

<tr><td class="prose"><p>This macro expands to an <code><span class="nf"><a href="boolean.html#definition_if:then:else:">if:</a></span><span class="nf"><a href="boolean.html#definition_if:then:else:">then:</a></span><span class="nf"><a href="boolean.html#definition_if:then:else:">else:</a></span></code> dispatch which checks if the class is in-scope. If it is, it simply calls the class creation body with the current class object, redefining all methods in the body. If it isn't defined, it just defines it.</p></td><td class="code"><div class="highlight"><pre><span class="kr">macro</span><span class="t"> </span><span class="p">(</span><span class="nf">class:</span><span class="t"> </span><span class="p">(</span><span class="nf">c:</span><span class="t"> </span><span class="n">Dispatch</span><span class="p">)</span><span class="p">)</span><span class="t">
  </span><span class="p">{</span><span class="t"> </span><span class="n">single</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n"><a href="particles.html#definition_Particle">Particle</a></span><span class="t"> </span><span class="nf">new:</span><span class="t"> </span><span class="n">c</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_names">names</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t">
    </span><span class="n"><a href="patterns.html#definition_name">name</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="ss">`Dispatch</span><span class="t"> </span><span class="nf">new:</span><span class="t"> </span><span class="n">single</span><span class="t"> </span><span class="nf">to:</span><span class="t"> </span><span class="p">[</span><span class="ss">'this</span><span class="p">]</span><span class="t">
    </span><span class="n">body</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">c</span><span class="t"> </span><span class="n"><a href="patterns.html#definition_targets">targets</a></span><span class="t"> </span><span class="nf"><a href="lists.html#definition_at:">at:</a></span><span class="t"> </span><span class="mi">1</span><span class="t">

    </span><span class="ss">`</span><span class="p">(</span><span class="nf">if:</span><span class="t"> </span><span class="p">(</span><span class="nf">responds-to?:</span><span class="t"> </span><span class="si">~single</span><span class="p">)</span><span class="t">
        </span><span class="nf">then:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="si">~</span><span class="p">(</span><span class="nf">class-create:</span><span class="t"> </span><span class="n">body</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_contents">contents</a></span><span class="p">)</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="si">~name</span><span class="t"> </span><span class="p">}</span><span class="t">
        </span><span class="nf">else:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="si">~name</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="si">~body</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_in-context">in-context</a></span><span class="p">)</span><span class="t">
  </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_call">call</a></span></pre></div></td></tr>

<tr><td class="prose"><p>Note that this works perfectly fine with arbitrary objects that weren't defined using our system. Everything expands to regular ol' objects and method definition - there is very little magic going on.</p><p>To prove it, I'll go ahead and reopen <code><span class="n"><a href="numbers.html#definition_Number">Number</a></span></code>, the object representing numeric values in Atomo, and add a little <code><span class="nf">plus:</span></code> method which will just be an alias for <code><span class="o"><a href="numbers.html#definition_+:">+</a></span></code>.

</p><div class="highlight"><pre><span class="nf">class:</span><span class="t"> </span><span class="nf">Number:</span><span class="t"> </span><span class="p">{</span><span class="t">
  </span><span class="nf">plus:</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="o"><a href="numbers.html#definition_+:">+</a></span><span class="t"> </span><span class="n">y</span><span class="t">
</span><span class="p">}</span></pre></div>

<pre class="interaction"><span class="caret">&gt;</span> <span class="mi">1</span><span class="t"> </span><span class="nf">plus:</span><span class="t"> </span><span class="mi">2</span>
<span class="mi">3</span>
</pre><p>Ta-da!</p><p>So far I've shown classes working and modules working, but not classes and modules working. So let's give that a shot.


</p><div class="highlight"><pre><span class="nf">module:</span><span class="t"> </span><span class="nf">MyEnumerable:</span><span class="t"> </span><span class="p">{</span><span class="t">
  </span><span class="nf"><a href="lists.html#definition_all?:">all?:</a></span><span class="t"> </span><span class="n">p</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
    </span><span class="p">{</span><span class="t"> </span><span class="n">done</span><span class="t"> </span><span class="o">|</span><span class="t">
      </span><span class="nf">each:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="p">(</span><span class="n">done</span><span class="t"> </span><span class="nf"><a href="continuations.html#definition_yield:">yield:</a></span><span class="t"> </span><span class="kc">False</span><span class="p">)</span><span class="t"> </span><span class="nf">unless:</span><span class="t"> </span><span class="p">(</span><span class="n">p</span><span class="t"> </span><span class="nf">call:</span><span class="t"> </span><span class="n">x</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t">
      </span><span class="kc">True</span><span class="t">
    </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="continuations.html#definition_call/cc">call/cc</a></span><span class="t">
</span><span class="p">}</span><span class="t">

</span><span class="nf">class:</span><span class="t"> </span><span class="nf">LinkedList:</span><span class="t"> </span><span class="p">{</span><span class="t">
  </span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">MyEnumerable</span><span class="t">

  </span><span class="n"><a href="core.html#definition_new">new</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="lists.html#definition_empty?">empty?</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="kc">True</span><span class="t"> </span><span class="p">}</span><span class="t">

  </span><span class="nf">new.head:</span><span class="t"> </span><span class="n">h</span><span class="t"> </span><span class="nf">tail:</span><span class="t"> </span><span class="n">t</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
    </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">h</span><span class="t">
      </span><span class="n"><a href="lists.html#definition_tail">tail</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">t</span><span class="t">
      </span><span class="n"><a href="lists.html#definition_empty?">empty?</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="kc">False</span><span class="t">
    </span><span class="p">}</span><span class="t">

  </span><span class="nf">from:</span><span class="t"> </span><span class="p">(</span><span class="nf">l:</span><span class="t"> </span><span class="n"><a href="lists.html#definition_List">List</a></span><span class="p">)</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
    </span><span class="n">l</span><span class="t"> </span><span class="nf"><a href="lists.html#definition_reduce-right:">reduce-right:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">h</span><span class="t"> </span><span class="n">t</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n">LinkedList</span><span class="t"> </span><span class="nf">new.head:</span><span class="t"> </span><span class="n">h</span><span class="t"> </span><span class="nf">tail:</span><span class="t"> </span><span class="n">t</span><span class="t"> </span><span class="p">}</span><span class="t">
        </span><span class="nf">with:</span><span class="t"> </span><span class="n">LinkedList</span><span class="t"> </span><span class="n"><a href="core.html#definition_new">new</a></span><span class="t">

  </span><span class="nf">each:</span><span class="t"> </span><span class="n">f</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
    </span><span class="nf">if:</span><span class="t"> </span><span class="n"><a href="lists.html#definition_empty?">empty?</a></span><span class="t">
      </span><span class="nf">then:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nd">@ok</span><span class="t"> </span><span class="p">}</span><span class="t">
      </span><span class="nf">else:</span><span class="t"> </span><span class="p">{</span><span class="t">
        </span><span class="n">f</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t">
        </span><span class="n"><a href="lists.html#definition_tail">tail</a></span><span class="t"> </span><span class="nf">each:</span><span class="t"> </span><span class="n">f</span><span class="t">
      </span><span class="p">}</span><span class="t">

  </span><span class="n"><a href="core.html#definition_show">show</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
    </span><span class="nf">if:</span><span class="t"> </span><span class="n"><a href="lists.html#definition_empty?">empty?</a></span><span class="t">
      </span><span class="nf">then:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="s">&quot;</span><span class="s">()</span><span class="s">&quot;</span><span class="t"> </span><span class="p">}</span><span class="t">
      </span><span class="nf">else:</span><span class="t"> </span><span class="p">{</span><span class="t">
        </span><span class="s">&quot;</span><span class="s">(</span><span class="s">&quot;</span><span class="t"> </span><span class="o"><a href="lists.html#definition_..:">..</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_head">head</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_show">show</a></span><span class="t"> </span><span class="o"><a href="lists.html#definition_..:">..</a></span><span class="t"> </span><span class="s">&quot;</span><span class="s"> : </span><span class="s">&quot;</span><span class="t"> </span><span class="o"><a href="lists.html#definition_..:">..</a></span><span class="t"> </span><span class="n"><a href="lists.html#definition_tail">tail</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_show">show</a></span><span class="t"> </span><span class="o"><a href="lists.html#definition_..:">..</a></span><span class="t"> </span><span class="s">&quot;</span><span class="s">)</span><span class="s">&quot;</span><span class="t">
      </span><span class="p">}</span><span class="t">
</span><span class="p">}</span></pre></div><p>Here I've implemented a (very) small subset of the <code>Enumerable</code> module found in Ruby, and a basic linked list class. This class provides the necessary <code><span class="nf">each:</span></code> method, and includes the <code><span class="n"><a href="enumerable.html#definition_Enumerable">Enumerable</a></span></code> module. Let's see if this works:

</p><pre class="interaction"><span class="caret">&gt;</span> <span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">LinkedList</span><span class="t"> </span><span class="nf">from:</span><span class="t"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="t"> </span><span class="mi">2</span><span class="p">]</span>
<span class="p">(</span><span class="mi">1</span><span class="t"> </span><span class="o">:</span><span class="t"> </span><span class="p">(</span><span class="mi">2</span><span class="t"> </span><span class="o">:</span><span class="t"> </span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">)</span>
<span class="caret">&gt;</span> <span class="n">x</span><span class="t"> </span><span class="nf">each:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="nd">@</span><span class="p">(</span><span class="nf">value:</span><span class="t"> </span><span class="n">x</span><span class="p">)</span><span class="t"> </span><span class="n"><a href="io.html#definition_print">print</a></span><span class="t"> </span><span class="p">}</span>
@(value: 1)
@(value: 2)
<span class="nd">@ok</span>
<span class="caret">&gt;</span> <span class="n">x</span><span class="t"> </span><span class="nf"><a href="lists.html#definition_all?:">all?:</a></span><span class="t"> </span><span class="nd">@</span><span class="p">(</span><span class="nf"><a href="core.html#definition_is-a?:">is-a?:</a></span><span class="t"> </span><span class="n"><a href="numbers.html#definition_Integer">Integer</a></span><span class="p">)</span>
<span class="kc">True</span>
<span class="caret">&gt;</span> <span class="n">x</span><span class="t"> </span><span class="nf"><a href="lists.html#definition_all?:">all?:</a></span><span class="t"> </span><span class="nd">@odd?</span>
<span class="kc">False</span>
</pre><p>Looks good to me! Now that we have everything working, let's see what exactly these macros expand to.</p></td><td class="code"></td></tr>

<tr><th class="prose"><h1>Digging In</h1></th><th class="code"></th></tr>

<tr><td class="prose"><p>We'll use the ever-so-useful <code><span class="n">expand</span></code> method to see what our macros are doing. Let's try it on a few variations of <code><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span></code>.

</p><pre class="interaction"><span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nd">@ok</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1104</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="nf">o:</span><span class="mi">1104</span><span class="p">;</span><span class="t"> </span><span class="nd">@ok</span><span class="p">;</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1104</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_Object">Object</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="p">)</span>
<span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf">class:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nd">@ok</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf">extends:</span><span class="t"> </span><span class="n"><a href="numbers.html#definition_Number">Number</a></span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="nf">class:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nd">@ok</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf">extends:</span><span class="t"> </span><span class="n"><a href="numbers.html#definition_Number">Number</a></span><span class="p">)</span>
<span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="core.html#definition_new">new</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t"> </span><span class="n">is-one?</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="comparable.html#definition_==:">==</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1106</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="nf">o:</span><span class="mi">1106</span><span class="p">;</span><span class="t">
             </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1106</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n"><a href="core.html#definition_new">new</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="nf">o:</span><span class="mi">1106</span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="t"> </span><span class="nf">do:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t">
             </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1106</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">is-one?</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">a</span><span class="t"> </span><span class="o"><a href="comparable.html#definition_==:">==</a></span><span class="t"> </span><span class="mi">1</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t">
             </span><span class="nf">o:</span><span class="mi">1106</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_Object">Object</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="p">)</span>
<span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf">class:</span><span class="t"> </span><span class="nf">A:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nd">@ok</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="nf">if:</span><span class="t"> </span><span class="p">(</span><span class="nf">responds-to?:</span><span class="t"> </span><span class="nd">@A</span><span class="p">)</span><span class="t">
    </span><span class="nf">then:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1116</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="nf">o:</span><span class="mi">1116</span><span class="p">;</span><span class="t"> </span><span class="nd">@ok</span><span class="p">;</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1116</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n">A</span><span class="t"> </span><span class="p">}</span><span class="t">
    </span><span class="nf">else:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">A</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t">
              </span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1119</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="nf">o:</span><span class="mi">1119</span><span class="p">;</span><span class="t">
                         </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1119</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n"><a href="pretty.html#definition_pretty">pretty</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="pretty.html#definition_Pretty">Pretty</a></span><span class="t"> </span><span class="nf"><a href="pretty.html#definition_text:">text:</a></span><span class="t"> </span><span class="s">&quot;</span><span class="s">A</span><span class="s">&quot;</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t">
                         </span><span class="nd">@ok</span><span class="p">;</span><span class="t">
                         </span><span class="nf">o:</span><span class="mi">1119</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_Object">Object</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="blocks.html#definition_in-context">in-context</a></span><span class="p">)</span>
</pre><p>As you can see, anonymous classes expand into a call to a class-creation block; the block is called with the cloned parent as an argument, and any methods are defined on it. The block then returns the class object.</p><p>We can also see that our bang-identifiers are being sprinkled with a bit of magic that keeps them from colliding with other identifiers. In fact, the parser rejects these names, but they're well past the parsing stage.</p><p>So what about including modules? What happens then? Let's see:

</p><pre class="interaction"><span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">Math</span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n">some-helper</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">10</span><span class="p">;</span><span class="t">
                    </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">pi</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="mf">3.14</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t">
                    </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">some-helper</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t">
    </span><span class="nf">with:</span><span class="t"> </span><span class="kr">this</span><span class="p">)</span>
<span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">MoreMath</span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="nf">join:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n">some-helper</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="mi">10</span><span class="p">;</span><span class="t">
                                              </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">pi</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="mf">3.14</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t">
                                              </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">some-helper</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t">
                              </span><span class="nf">with:</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="p">;</span><span class="t">
                    </span><span class="n">another-helper</span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="n">pi</span><span class="p">;</span><span class="t">
                    </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">pi*2</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">another-helper</span><span class="t"> </span><span class="o"><a href="numbers.html#definition_*:">*</a></span><span class="t"> </span><span class="mi">2</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t">
    </span><span class="nf">with:</span><span class="t"> </span><span class="kr">this</span><span class="p">)</span>
</pre><p>We see that including modules defines the module's contents onto a given target (in this case the toplevel object, <code><span class="kr">this</span></code>). This is done by <code><span class="nd">@join:</span></code>ing its body onto the target, passing an explicit reference to it along as an argument. Including one module in another does the same as anything else, but what about including a module into a class definition?

</p><pre class="interaction"><span class="caret">&gt;</span> <span class="ss">`</span><span class="p">(</span><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">MyEnumerable</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="n">expand</span>
<span class="ss">'</span><span class="p">(</span><span class="p">{</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1132</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="o"><a href="core.html#definition_=:">=</a></span><span class="t"> </span><span class="nf">o:</span><span class="mi">1132</span><span class="p">;</span><span class="t">
             </span><span class="nf">o:</span><span class="mi">1132</span><span class="t"> </span><span class="nf">join:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="p">(</span><span class="nf">me:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="nf">top:</span><span class="mi">422</span><span class="t"> </span><span class="p">}</span><span class="p">)</span><span class="t"> </span><span class="nf"><a href="lists.html#definition_all?:">all?:</a></span><span class="t"> </span><span class="n">p</span><span class="t"> </span><span class="o"><a href="core.html#definition_:=:">:=</a></span><span class="t">
                                        </span><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_join:">join:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">done</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="nf">each:</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="o">|</span><span class="t"> </span><span class="nf">unless:</span><span class="t"> </span><span class="p">(</span><span class="n">p</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n">x</span><span class="p">)</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_do:">do:</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n">done</span><span class="t"> </span><span class="nf"><a href="continuations.html#definition_yield:">yield:</a></span><span class="t"> </span><span class="kc">False</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="p">;</span><span class="t">
                                                            </span><span class="kc">True</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="continuations.html#definition_call/cc">call/cc</a></span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t">
                      </span><span class="nf">with:</span><span class="t"> </span><span class="nf">o:</span><span class="mi">1132</span><span class="p">;</span><span class="t">
             </span><span class="nf">o:</span><span class="mi">1132</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="nf"><a href="blocks.html#definition_call:">call:</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_Object">Object</a></span><span class="t"> </span><span class="n"><a href="core.html#definition_clone">clone</a></span><span class="p">)</span>
</pre><p>Earlier we actually made <code><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span></code> inside of a class expand into something slightly different from the normal macro. The only thing we changed was that its target is the class object being built, rather than the context of the building. It's a bit tricky to explain, but basically we're making it so that <code><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">SomeModule</span></code> inside of a class body acts like <code><span class="n"><a href="class-objects.html#definition_me">me</a></span><span class="t"> </span><span class="nf"><a href="ecosystem.html#definition_include:">include:</a></span><span class="t"> </span><span class="n">SomeModule</span></code>.</p></td><td class="code"></td></tr>

<tr><th class="prose"><h1>Wrapping Up</h1></th><th class="code"></th></tr>

<tr><td class="prose"><p>In just a few lines of code we've written a simple, elegant, and low-overhead implementation of Ruby's <code>module</code>, <code>class</code>, and <code>include</code> forms. What's more, code written using these forms doesn't force others to adopt these idioms - everything expands into simple Atomo code that will be natural to any users of your API.</p><p>We've used a few things you should remember: <code><span class="kr">for-macro</span></code> for defining helper methods and values for your macros, <code><span class="kr">macro</span></code> for code that creates code, and the use of <code><span class="n">!bangs</span></code> to achieve hygienic macros without any mental overhead. We've also briefly shown <code><span class="n">expand</span></code>, a very useful method to use when writing macros to see what's <em>really</em> happening to your code.</p><p>You may have noticed something missing, though. You can't do this:

</p><div class="highlight"><pre><span class="nf">class:</span><span class="t"> </span><span class="nf">A:</span><span class="t"> </span><span class="p">{</span><span class="p">}</span><span class="t"> </span><span class="nf">&amp;extends:</span><span class="t"> </span><span class="n">B</span></pre></div><p>The implementation isn't too hard, though; just remember that it's actually parsed as <code><span class="nf"><a href="class-objects.html#definition_class:">class:</a></span><span class="t"> </span><span class="p">(</span><span class="nf">A:</span><span class="t"> </span><span class="p">{</span><span class="p">}</span><span class="t"> </span><span class="nf">&amp;extends:</span><span class="t"> </span><span class="n">B</span><span class="p">)</span></code>. This is left as an exercise. Good luck!</p></td><td class="code"></td></tr>
</table>
    </div>
  </body>
</html>
