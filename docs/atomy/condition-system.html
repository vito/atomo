<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>Condition System</title>
<link rel="stylesheet" type="text/css" href="public/doodle.css">
<script type="text/javascript" src="public/jquery.js"></script><script type="text/javascript" src="public/jquery.hotkeys.js"></script><script type="text/javascript" src="public/tags.js"></script><script type="text/javascript" src="public/main.js"></script><link rel="stylesheet" type="text/css" href="public/highlight.css">
</head>
<body>
<div id="main"><div id="content"><div class="section">
<h1 class="section_header">Condition System</h1>
<p>  Rather than traditional exceptions, Atomy sports a condition/restart   system modeled on Common Lisp's design. The native Ruby exception handling   is available, but conditions and restarts are much more flexible.</p>
<div class="section" id="section_conditions">
<h2 class="section_header">Conditions</h2>
<div id="definition_Condition" class="definition">
<pre class="thumb"><span class="no">Condition</span><span class="o">:</span><span class="t">
  </span><span class="no">Error</span><span class="p">(</span><span class="vi">@backtrace</span><span class="p">)</span><span class="o">:</span><span class="t">
    </span><span class="no">SimpleError</span><span class="p">(</span><span class="vi">@value</span><span class="p">)</span><span class="t">
    </span><span class="no">ExceptionError</span><span class="p">(</span><span class="vi">@exception</span><span class="p">)</span><span class="t">
    </span><span class="no">NoRestartError</span><span class="p">(</span><span class="vi">@name</span><span class="p">)</span><span class="t">
    </span><span class="no">PortError</span><span class="p">(</span><span class="vi">@port</span><span class="p">)</span><span class="o">:</span><span class="t">
      </span><span class="no">EndOfFile</span><span class="t">
  </span><span class="no">Warning</span><span class="p">(</span><span class="vi">@backtrace</span><span class="p">)</span><span class="o">:</span><span class="t">
    </span><span class="no">SimpleWarning</span><span class="p">(</span><span class="vi">@value</span><span class="p">)</span> </pre>
<p>Condition system hierarchy. You should subclass one of these to create     your own conditions.</p>
</div>
<div id="definition_name" class="definition">
<pre class="thumb"><span class="no">Condition</span><span class="t"> </span><span class="n"><a href="conditions.html#definition_name">name</a></span> </pre>
<p>Get the name of a condition. By default, this will be the class name,     but you may override this for your own behaviour.</p>
</div>
<div id="definition_message" class="definition">
<pre class="thumb"><span class="no">Condition</span><span class="t"> </span><span class="n"><a href="conditions.html#definition_message">message</a></span> </pre>
<p>A human-friendly message displayed for the condition. Override this.</p>
</div>
</div>
<div class="section" id="section_handling">
<h2 class="section_header">Handling</h2>
<div id="definition_restart" class="definition">
<pre class="thumb"><span class="n"><a href="handling.html#definition_restart">restart</a></span><span class="p">(</span><span class="n"><a href="conditions.html#definition_name">name</a></span><span class="p">,</span><span class="t"> </span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="definition_result_arrow">&rArr;</span> <span class="n">any</span>
  | <span class="n"><a href="conditions.html#definition_name">name</a></span><span class="t"> </span><span class="n">is-a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span></pre>
<p>Invoke the <code><span class="n"><a href="conditions.html#definition_name">name</a></span></code> restart, passing <code><span class="n">args</span></code> along to its callback.</p>
<p>See <code><span class="n">with-restarts</span></code>.</p>
<div class="example">
<p><em>Example:</em></p>
<pre class="interaction"><span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">foo</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="mi">42</span><span class="p">)</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#bar</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#bar</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="n"><a href="handling.html#definition_restart">restart</a></span><span class="p">(</span><span class="ss">#foo</span><span class="p">)</span><span class="t">
</span><span class="mi">42</span>
</pre>
</div>
</div>
<div id="definition_bind" class="definition">
<pre class="thumb"><span class="n">body</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="p">(</span><span class="o">&amp;</span><span class="n">y</span><span class="p">)</span> <span class="definition_result_arrow">&rArr;</span> <span class="n">any</span>
  | <span class="n">y</span><span class="t"> </span><span class="n">contents</span><span class="t"> </span><span class="n">all?</span><span class="t"> </span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">:</span><span class="t"> </span><span class="n">x</span><span class="t"> </span><span class="n">match</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="o">`</span><span class="p">(</span><span class="o">~</span><span class="n">_</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="o">~</span><span class="n">_</span><span class="p">)</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="kc">true</span><span class="p">,</span><span class="t"> </span><span class="n">_</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="kc">false</span><span class="t"> </span><span class="p">}</span></pre>
<p>Register handlers for various signals for the duration of <code><span class="n">x</span></code>'s     execution.</p>
<p>The body of <code><span class="n">y</span></code> is similar to <code><span class="n">match</span></code>; <code><span class="n">pattern</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t">     </span><span class="n">body</span></code>.</p>
<p>The result is the result of <code><span class="n">body</span></code>.</p>
<div class="example">
<p><em>Example:</em></p>
<pre class="interaction"><span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="s">"</span><span class="s">got A!</span><span class="s">"</span><span class="t"> </span><span class="n">print</span><span class="t">
</span>got A!
<span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#b</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="s">"</span><span class="s">got A!</span><span class="s">"</span><span class="t"> </span><span class="n">print</span><span class="t">
</span><span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="s">"</span><span class="s">inner</span><span class="s">"</span><span class="t"> </span><span class="n">print</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="s">"</span><span class="s">outer</span><span class="s">"</span><span class="t"> </span><span class="n">print</span><span class="t">
</span>inner
outer
<span class="kc">nil</span>
</pre>
</div>
</div>
<div id="definition_with_restarts" class="definition">
<pre class="thumb"><span class="n">with-restarts</span><span class="p">(</span><span class="o">*</span><span class="n">restarts</span><span class="p">,</span><span class="t"> </span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="definition_result_arrow">&rArr;</span> <span class="n">any</span></pre>
<p>Register restarts available for the duration of <code><span class="n">body</span></code>'s execution.</p>
<p>The <code><span class="n">restarts</span></code> should be in the form of     <code><span class="n"><a href="conditions.html#definition_name">name</a></span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="n">body</span></code>.</p>
<p>The result is the result of <code><span class="n">body</span></code>.</p>
<div class="example">
<p><em>Example:</em></p>
<pre class="interaction"><span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">x</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="mi">1</span><span class="p">,</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="mi">2</span><span class="p">)</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="n"><a href="handling.html#definition_restart">restart</a></span><span class="p">(</span><span class="ss">#x</span><span class="p">)</span><span class="t">
</span><span class="mi">1</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">x</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="mi">1</span><span class="p">,</span><span class="t"> </span><span class="n">y</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="mi">2</span><span class="p">)</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="n"><a href="handling.html#definition_restart">restart</a></span><span class="p">(</span><span class="ss">#y</span><span class="p">)</span><span class="t">
</span><span class="mi">2</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n">with-restarts</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="p">(</span><span class="n">a</span><span class="t"> </span><span class="o">*</span><span class="t"> </span><span class="mi">7</span><span class="p">)</span><span class="p">)</span><span class="t"> </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#a</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#a</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="n"><a href="handling.html#definition_restart">restart</a></span><span class="p">(</span><span class="ss">#x</span><span class="p">,</span><span class="t"> </span><span class="mi">6</span><span class="p">)</span><span class="t">
</span><span class="mi">42</span>
</pre>
</div>
</div>
</div>
<div class="section" id="section_signalling">
<h2 class="section_header">Signalling</h2>
<div id="definition_signal" class="definition">
<pre class="thumb"><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="definition_result_arrow">&rArr;</span> <span class="kc">nil</span></pre>
<p>Signal a value through all bound handlers, nearest-first, stopping when     a restart is invoked.</p>
<div class="example">
<p><em>Example:</em></p>
<pre class="interaction"><span class="caret">&gt; </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#foo</span><span class="p">)</span><span class="t">
</span><span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_signal">signal</a></span><span class="p">(</span><span class="ss">#foo</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="ss">#foo</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="s">"</span><span class="s">got foo</span><span class="s">"</span><span class="t"> </span><span class="n">print</span><span class="t">
</span>got foo
<span class="kc">nil</span>
</pre>
</div>
</div>
<div id="definition_error" class="definition">
<pre class="thumb"><span class="n"><a href="signalling.html#definition_error">error</a></span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="definition_result_arrow">&rArr;</span> <span class="n">_</span></pre>
<p>Like <code><span class="n"><a href="signalling.html#definition_signal">signal</a></span></code>, except that if no restart is invoked, the current     <code><span class="o">^</span><span class="n">debugger</span></code> is started.</p>
<p>If the given value is not an <code><span class="no">Error</span></code>, it is wrapped in a     <code><span class="no">SimpleError</span></code>. If the value is a Ruby <code><span class="no">Exception</span></code>, it is wrapped     in an <code><span class="no">ExceptionError</span></code>.</p>
<div class="example">
<p><em>Example:</em></p>
<pre class="interaction"><span class="caret">&gt; </span><span class="n"><a href="signalling.html#definition_error">error</a></span><span class="p">(</span><span class="s">"</span><span class="s">Oh no!</span><span class="s">"</span><span class="p">)</span><span class="t">
</span><span class="gr">ERROR: Oh no!</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_error">error</a></span><span class="p">(</span><span class="s">"</span><span class="s">Oh no!</span><span class="s">"</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="no">Error</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="s">"</span><span class="s">INCOMING</span><span class="s">"</span><span class="t"> </span><span class="n">print</span><span class="t">
</span>INCOMING
<span class="gr">ERROR: Oh no!</span>
</pre>
</div>
</div>
<div id="definition_warning" class="definition">
<pre class="thumb"><span class="n"><a href="signalling.html#definition_warning">warning</a></span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="definition_result_arrow">&rArr;</span> <span class="kc">nil</span></pre>
<p>Like <code><span class="n"><a href="signalling.html#definition_signal">signal</a></span></code>, except that if no restart is invoked, the warning is     printed to <code><span class="o">^</span><span class="n">error-port</span></code>.</p>
<p>If the given value is not a <code><span class="no">Warning</span></code>, it is wrapped in a     <code><span class="no">SimpleWarning</span></code>. Warning messages can be muffled by binding for     <code><span class="no">Warning</span></code> and invoking the <code><span class="ss">#muffle-warning</span></code> restart.</p>
<div class="example">
<p><em>Example:</em></p>
<pre class="interaction"><span class="caret">&gt; </span><span class="n"><a href="signalling.html#definition_warning">warning</a></span><span class="p">(</span><span class="s">"</span><span class="s">Suspicious!</span><span class="s">"</span><span class="p">)</span><span class="t">
</span><span class="kc">nil</span>
<span class="caret">&gt; </span><span class="p">{</span><span class="t"> </span><span class="n"><a href="signalling.html#definition_warning">warning</a></span><span class="p">(</span><span class="s">"</span><span class="s">Quiet, you!</span><span class="s">"</span><span class="p">)</span><span class="t"> </span><span class="p">}</span><span class="t"> </span><span class="n"><a href="handling.html#definition_bind">bind</a></span><span class="o">:</span><span class="t"> </span><span class="no">Warning</span><span class="t"> </span><span class="o">-</span><span class="o">&gt;</span><span class="t"> </span><span class="n"><a href="handling.html#definition_restart">restart</a></span><span class="p">(</span><span class="ss">#muffle-warning</span><span class="p">)</span><span class="t">
</span><span class="kc">nil</span>
</pre>
</div>
</div>
</div>
<div class="section" id="section_debuggers">
<h2 class="section_header">Debuggers</h2>
<div id="definition_DefaultDebugger" class="definition">
<pre class="thumb"><span class="no">DefaultDebugger</span> <span class="definition_result_arrow">&rArr;</span> <span class="no">Class</span></pre>
<p>The default debugger. This will show the condition name, its message,     and let the user pick from the available restarts.</p>
</div>
<div id="definition_^@" class="definition">
<pre class="thumb"><span class="o">^</span><span class="n">debugger</span> <span class="definition_result_arrow">&rArr;</span> <span class="no">DefaultDebugger</span>
  | <span class="n">respond-to?</span><span class="p">(</span><span class="ss">#run</span><span class="p">)</span></pre>
<p>The current debugger. <code><span class="n">run</span></code> will be called with the condition as an     argument.</p>
</div>
</div>
</div></div></div>
<div class="search">
<form action="javascript:void(0)"><input autocomplete="off" type="text" placeholder="Search&hellip;" id="search"></form>
<ul class="search_results"></ul>
</div>
<div id="sidebar">
<h4>On this page:</h4>
<ol class="toc">
<li><a href="condition-system.html#section_conditions">Conditions</a></li>
<li><a href="condition-system.html#section_handling">Handling</a></li>
<li><a href="condition-system.html#section_signalling">Signalling</a></li>
<li><a href="condition-system.html#section_debuggers">Debuggers</a></li>
</ol>
<h4>Up one level:</h4>
<ol class="toc"><li>
<a href="reference.html">Reference</a><ol>
<li>
<a href="concurrency.html">Concurrency</a><ol>
<li><a href="concurrency.html#section_sending-and-receiving">Sending &amp; Receiving</a></li>
<li><a href="concurrency.html#section_spawning">Spawning</a></li>
</ol>
</li>
<li>
<a href="condition-system.html">Condition System</a><ol>
<li><a href="condition-system.html#section_conditions">Conditions</a></li>
<li><a href="condition-system.html#section_handling">Handling</a></li>
<li><a href="condition-system.html#section_signalling">Signalling</a></li>
<li><a href="condition-system.html#section_debuggers">Debuggers</a></li>
</ol>
</li>
<li>
<a href="pretty-printing.html">Pretty-Printing</a><ol>
<li><a href="pretty-printing.html#section_documents">Documents</a></li>
<li><a href="pretty-printing.html#section_constructing">Constructing</a></li>
<li>
<a href="pretty-printing.html#section_helpers">Helpers</a><ol>
<li><a href="pretty-printing.html#section_shortcuts">Shortcuts</a></li>
<li><a href="pretty-printing.html#section_wrapping">Wrapping</a></li>
<li><a href="pretty-printing.html#section_combining">Combining</a></li>
</ol>
</li>
</ol>
</li>
<li>
<a href="input-and-output.html">Input &amp; Output</a><ol>
<li><a href="input-and-output.html#section_output">Output</a></li>
<li><a href="input-and-output.html#section_input">Input</a></li>
</ol>
</li>
<li><a href="the-repl.html">The REPL</a></li>
<li>
<a href="testing-with-therie.html">Testing with Therie</a><ol>
<li><a href="testing-with-therie.html#section_structure">Structure</a></li>
<li><a href="testing-with-therie.html#section_tests">Tests</a></li>
</ol>
</li>
</ol>
</li></ol>
</div>
</body>
</html>
